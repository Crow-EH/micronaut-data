<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script src="/cdn-cgi/apps/head/3cOPSgo5Omz84ycX7CvigfX4cpw.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-82213539-2');
    </script>
    <title>9 Going Native with GraalVM 1.1.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut Data
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/quickStart.html"><strong>2</strong><span>Quick Start</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/buildConfig.html"><strong>3</strong><span>Build Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/repositories.html"><strong>4</strong><span>Repository Interfaces</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/querying.html"><strong>5</strong><span>Writing Queries</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/dataUpdates.html"><strong>6</strong><span>Updating Data</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/howItWorks.html"><strong>7</strong><span>How Micronaut Data Works</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/sql.html"><strong>8</strong><span>Micronaut Data with SQL</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/graal.html"><strong>9</strong><span>Going Native with GraalVM</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/spring.html"><strong>10</strong><span>Spring Data Support</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/sql.html">&lt;&lt; <strong>8</strong><span>Micronaut Data with SQL</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/spring.html"><strong>10</strong><span>Spring Data Support</span> >></a></div>
                


                <div class="project">
                    <h1>9 Going Native with GraalVM</h1>

                    <p><strong>Version:</strong> 1.1.0.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#graalJDBC"><strong>9.1</strong><span>JDBC and Native Builds</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#graalJPA"><strong>9.2</strong><span>JPA and Native Builds</span></a>
                    </div>
                    
                </div>
                

                
<h1 id="graal"><a class="anchor" href="#graal"></a>9 Going Native with GraalVM</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Data supports GraalVM native images for both the JPA and JDBC implementations.</p>
</div>
<div class="paragraph">
<p>Before you can build a native image however there are a few changes you need to make to your project to allow a native build.</p>
</div>
<div class="paragraph">
<p>The following sections describe the changes you need to make.</p>
</div>

<h2 id="graalJDBC"><a class="anchor" href="#graalJDBC"></a>9.1 JDBC and Native Builds</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/graal/graalJDBC.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Getting your project ready for a native GraalVM build is JDBC driver dependent.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
GraalVM substrate remains an evolving and experimental feature of GraalVM, hence support for GraalVM substrate in Micronaut Data is also regarded as experimental and evolving.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generally you need to add a <code>@TypeHint(&#8230;&#8203;)</code> declaration to your <code>Application</code> class that tells GraalVM what is the class that represents the JDBC driver and you need to add the driver to the class that are initialized at build time with the <code>--initialize-at-build-time=DRIVER_CLASS_NAME</code> flag which you can add to the <code>native-image.properties</code> file found in <code>src/main/resources/META-INF/native-image</code> for a project that was created with <code>mn create-app my-app --features graal-native-image</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MySQL is as of this time unsupported in native image due to <a href="https://bugs.mysql.com/bug.php?id=91968">this issue</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuration_for_h2">Configuration for H2</h4>
<div class="paragraph">
<p>The changes for H2 are:</p>
</div>
<div class="listingblock">
<div class="title"><code>@TypeHint</code> Declaration in Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(typeNames = {"org.h2.Driver", "org.h2.mvstore.db.MVTableEngine"})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GraalVM Flags</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--report-unsupported-elements-at-runtime --initialize-at-build-time=org.h2.Driver</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>--report-unsupported-elements-at-runtime</code> flag is needed for H2 if you use the embedded H2 server otherwise can be omitted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_for_postgres">Configuration for Postgres</h4>
<div class="paragraph">
<p>The changes for Postgres JDBC Driver (<code>org.postgresql:postgresql:42.2.8</code> or above) are:</p>
</div>
<div class="listingblock">
<div class="title"><code>@TypeHint</code> Declaration in Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(org.postgresql.Driver.class)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GraalVM Flags</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--initialize-at-build-time=org.postgresql.Driver,org.postgresql.util.SharedTimer</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_for_oracle">Configuration for Oracle</h4>
<div class="paragraph">
<p>The changes for Oracle JDBC driver (<code>com.oracle.ojdbc:ojdbc8:19.3.0.0</code> or above) are quite extensive and are documented in <a href="https://github.com/oracle/graal/issues/1748#issuecomment-542353582">this Github issue</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_for_microsoft_sql_server">Configuration for Microsoft SQL Server</h4>
<div class="paragraph">
<p>The changes for SQL Server JDBC Driver (<code>com.microsoft.sqlserver:mssql-jdbc:7.2.2.jre8</code> or above) are:</p>
</div>
<div class="listingblock">
<div class="title"><code>@TypeHint</code> Declaration in Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(typeNames = "com.microsoft.sqlserver.jdbc.SQLServerDriver")</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GraalVM Flags</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-H:IncludeResourceBundles=com.microsoft.sqlserver.jdbc.SQLServerResource \
--initialize-at-build-time=com.microsoft.sqlserver.jdbc.SQLServerResource \
--initialize-at-run-time=java.sql.DriverManager</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_for_mariadb">Configuration for MariaDB</h4>
<div class="paragraph">
<p>The changes for MariaDB driver (<code>org.mariadb.jdbc:mariadb-java-client:2.5.2</code> or above) are:</p>
</div>
<div class="listingblock">
<div class="title"><code>@TypeHint</code> Declaration in Application Class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TypeHint(value = {
        org.mariadb.jdbc.util.Options.class,
        org.mariadb.jdbc.Driver.class
},
accessType = TypeHint.AccessType.ALL_PUBLIC)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">GraalVM Flags</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">--initialize-at-build-time=org.mariadb \
--initialize-at-run-time=org.mariadb.jdbc.credential.aws,org.mariadb.jdbc.internal.failover.impl.MastersSlavesListener,org.mariadb.jdbc.internal.com.send.authentication.SendPamAuthPacket</code></pre>
</div>
</div>
</div>

<h2 id="graalJPA"><a class="anchor" href="#graalJPA"></a>9.2 JPA and Native Builds</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-data/edit/master/src/main/docs/guide/graal/graalJPA.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you are using JPA then in addition to the above configuration you should add modify your <code>@TypeHint</code> declaration to include a reference to the Hibernate dialect associated with the database you are using.</p>
</div>
<div class="paragraph">
<p>For example for Postgres:</p>
</div>
<div class="listingblock">
<div class="title">Postgres Dialect Config</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.hibernate.dialect.PostgreSQL10Dialect;
import org.postgresql.Driver;

...

@TypeHint( {
    PostgreSQL10Dialect.class,
    Driver.class
})</code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/sql.html">&lt;&lt; <strong>8</strong><span>Micronaut Data with SQL</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/spring.html"><strong>10</strong><span>Spring Data Support</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
